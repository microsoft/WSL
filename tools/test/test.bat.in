@echo off

rem This script is generated by CMake. See: tools/test/test.bat.in

set "Bin=${CMAKE_RUNTIME_OUTPUT_DIRECTORY}\${CMAKE_BUILD_TYPE}"
set "Tools=${CMAKE_CURRENT_LIST_DIR}\tools"
path %PATH%;${TAEF_SOURCE_DIR}\build\Binaries\${TARGET_PLATFORM}

powershell.exe -ExecutionPolicy Bypass "%tools%\test\run-tests.ps1" -SetupScript "%tools%\test\test-setup.ps1" -DistroPath "${TEST_DISTRO_SOURCE_DIR}test_distro.tar.xz" -TestDllPath "%bin%\wsltests.dll" -UnitTestsPath "${CMAKE_CURRENT_LIST_DIR}\test\linux\unit_tests" -Package "%bin%\installer.msix" %* || goto fail

exit /b 0

:fail

echo "Test failed"
exit /b 1